---
title: 'Comment : ouvrir un modèle depuis un fichier dans le code de programme'
description: Découvrez que ModelBus fournit un mécanisme standard pour référencer un modèle ou des éléments dans un modèle, et pour rechercher le modèle s’il a été déplacé.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: how-to
author: mgoertz-msft
ms.author: mgoertz
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: 97de2d7e79dc44ff785663c4d04dc65851430472
ms.sourcegitcommit: e3a364c014ccdada0860cc4930d428808e20d667
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 06/19/2021
ms.locfileid: "112387058"
---
# <a name="how-to-open-a-model-from-file-in-program-code"></a>Comment : ouvrir un modèle depuis un fichier dans le code de programme

Vous pouvez ouvrir des modèles DSL dans n’importe quelle application.

À partir d’une extension Visual Studio, vous pouvez utiliser ModelBus à cet effet. ModelBus fournit un mécanisme standard pour référencer un modèle ou des éléments dans un modèle, et pour rechercher le modèle s’il a été déplacé. Pour plus d’informations, consultez [intégration de modèles à l’aide de Visual Studio Modelbus](../modeling/integrating-models-by-using-visual-studio-modelbus.md).

## <a name="target-framework"></a>Version cible de .NET Framework

Définissez la version **cible de .NET Framework** de votre projet d’application sur .NET Framework 4 ou version ultérieure.

1. Ouvrez le projet Visual Studio pour l’application dans laquelle vous souhaitez lire un modèle DSL.

2. Dans **Explorateur de solutions**, cliquez avec le bouton droit sur le projet, puis cliquez sur **Propriétés**.

3. Dans la fenêtre Propriétés du projet, sous l’onglet **application** , définissez le champ **framework cible** sur **.NET Framework 4** (ou version ultérieure).

> [!NOTE]
> La version cible de .NET Framework ne doit pas être **.NET Framework 4 profil client**.

## <a name="references"></a>Références

Ajoutez ces références à votre projet d’application Visual Studio :

- `Microsoft.VisualStudio.Modeling.Sdk.11.0`

  - Si vous ne voyez pas cela sous l’onglet **.net** de la boîte de dialogue **Ajouter des références** , cliquez sur l’onglet **Parcourir** et accédez à `%Program Files%\Microsoft Visual Studio 2010 SDK\VisualStudioIntegration\Common\Assemblies\` .

- Votre assembly DSL, que vous trouverez dans le dossier bin de votre projet DSL. Son nom se présente généralement sous la forme : *votresociété*. *YourProject* `.Dsl.dll` .

## <a name="important-classes-in-the-dsl"></a>Classes importantes dans le DSL

Avant de pouvoir écrire le code qui lit votre DSL, vous devez connaître les noms de certaines des classes générées par votre DSL. Dans votre solution DSL, ouvrez le projet **DSL** et recherchez dans le dossier **GeneratedCode** . Vous pouvez également double-cliquer sur l’assembly DSL dans vos **références** de projet et ouvrir l’espace de noms DSL dans l' **Explorateur d’objets**.

Il s’agit des classes que vous devez identifier :

- *YourDslRootClass* : il s’agit du nom de la classe racine dans votre `DslDefinition.dsl` .

- *YourDslName* `SerializationHelper` -Cette classe est définie dans `SerializationHelper.cs` dans votre projet DSL.

- *YourDslName* `DomainModel` -Cette classe est définie dans `DomainModel.cs` dans votre projet DSL.

## <a name="read-from-a-file"></a>Lire depuis un fichier

L’exemple suivant est conçu pour lire une DSL dans laquelle les classes importantes sont les suivantes :

- FamilyTreeModel

- FamilyTreeSerializationHelper

- FamilyTreeDomainModel

L’autre classe de domaine de ce DSL est Person.

```csharp
using System;
using Microsoft.VisualStudio.Modeling;
using Company.FamilyTree; // Your DSL namespace

namespace StandaloneReadDslConsole
{ class Program
  { static void Main(string[] args)
    {
      // The path of a DSL model file:
      string dslModel = @"C:\FamilyTrees\Tudor.ftree";
      // Set up the Store to read your type of model:
      Store store = new Store(
        typeof(Company.FamilyTree.FamilyTreeDomainModel));
      // The Model type generated by the DSL:
      FamilyTreeModel familyTree;
      // All Store changes must be in a Transaction:
      using (Transaction t =
        store.TransactionManager.BeginTransaction("Load model"))
      {
        familyTree =
           FamilyTreeSerializationHelper.Instance.
              LoadModel(store, dslModel, null, null, null);
        t.Commit(); // Don't forget this!
      }
      // Now we can read the model:
      foreach (Person p in familyTree.People)
      {
        Console.WriteLine(p.Name);
        foreach (Person child in p.Children)
        {
          Console.WriteLine("    " + child.Name);
        }
} } } }
```

## <a name="save-to-a-file"></a>Enregistrer dans un fichier

L’ajout suivant au code précédent apporte une modification au modèle, puis l’enregistre dans un fichier.

```csharp
using (Transaction t =
  store.TransactionManager.BeginTransaction("update model"))
{
  // Create a new model element:
  Person p = new Person(store);
  // Set its embedding relationship:
  p.FamilyTreeModel = familyTree;
  // - same as: familyTree.People.Add(p);
  // Set its properties:
  p.Name = "Edward VI";
  t.Commit(); // Don't forget this!
}
// Save the model:
try
{
  SerializationResult result = new SerializationResult();
  FamilyTreeSerializationHelper.Instance
    .SaveModel(result, familyTree, @"C:\FamilyTrees\Tudor-upd.ftree");
  // Report any error:
  if (result.Failed)
  {
    foreach (SerializationMessage message in result)
    {
      Console.WriteLine(message);
    }
  }
}
catch (System.IO.IOException ex)
{ ... }
```
