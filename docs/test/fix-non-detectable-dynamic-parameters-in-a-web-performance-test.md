---
title: Corriger les paramètres dynamiques non détectables dans un test de performances web dans Visual Studio
ms.date: 10/19/2016
ms.topic: conceptual
helpviewer_keywords:
- walkthroughs, load tests
- load tests, walkthroughs
- load tests, correlating dynamic parameters
ms.assetid: 92dff25c-36ee-4135-acdd-315c4962fa11
author: gewarren
ms.author: gewarren
manager: douge
ms.prod: visual-studio-dev15
ms.technology: vs-ide-test
ms.openlocfilehash: 379291059157980a86d0379c69c0d592eee83a99
ms.sourcegitcommit: 5b767247b3d819a99deb0dbce729a0562b9654ba
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/20/2018
ms.locfileid: "39177823"
---
# <a name="fix-non-detectable-dynamic-parameters-in-a-web-performance-test"></a>Corriger les paramètres dynamiques non détectables dans un test de performances de site Web

Certains sites web utilisent des paramètres dynamiques pour traiter certaines de leurs requêtes Web. Un paramètre dynamique est un paramètre dont la valeur est régénérée chaque fois qu'un utilisateur exécute l'application. Un ID de session est un exemple de paramètre dynamique. En règle générale, l'ID de session change toutes les 5 à 30 minutes. L'enregistreur et le moteur de lecture des tests de performances de site Web gèrent automatiquement les types les plus communs de paramètres dynamiques :

-   Valeurs de paramètre dynamique qui sont définies dans une valeur de cookie. Le moteur de test de performances de site Web les gère automatiquement pendant la lecture.

-   Valeurs de paramètre dynamique qui sont définies dans les champs masqués des pages HTML, telles que l'état d'affichage ASP.NET. Celles-ci sont gérées automatiquement par l'enregistreur qui ajoute des règles d'extraction de champs masqués au test.

-   Valeurs de paramètre dynamique qui sont définies comme paramètres de chaîne de requête ou de publication de formulaire. Celles-ci sont gérées par le biais de la détection des paramètres dynamiques après avoir enregistré un test de performances web.

Certains types de paramètres dynamiques ne sont pas détectés. Un paramètre dynamique non détecté provoquera l'échec du test de performances de site Web lors de son exécution, car la valeur dynamique sera différente à chaque exécution du test. Pour gérer correctement ces paramètres, vous pouvez ajouter manuellement des règles d'extraction aux paramètres dynamiques dans les tests de performances de site Web.

## <a name="create-and-run-a-web-app-with-dynamic-parameters"></a>Créer et exécuter une application Web avec les paramètres dynamiques

Pour illustrer un paramètre dynamique détectable et non détectable, nous créerons une application Web ASP.NET simple qui a trois formulaires Web avec des contrôles et du code personnalisé. Nous apprendrons ensuite comment isoler les paramètres dynamiques, ainsi qu'à les gérer.

1.  Créez un projet ASP.NET nommé **DynamicParameterSample**.

     ![Créer un projet d'application web ASP.NET vide](../test/media/web_test_dynamicparameter_aspproject.png)

2.  Ajoutez un formulaire web nommé *Querystring.aspx*.

3.  En mode de conception, faites glisser un HiddenField sur la page et remplacez la valeur de la propriété (ID) par HiddenFieldSessionID.

     ![Ajouter un contrôle HiddenField](../test/media/web_test_dynamicparameter_hiddenfield.png)

4.  Passez en mode Source pour la page Querystring, puis ajoutez le code ASP.NET et JavaScript en surbrillance suivant utilisé pour générer les paramètres dynamiques d'identification de session fictifs :

    ```html
    <head runat="server">
    <title>JavaScript dynamic property correlation sample</title><script type="text/javascript" language="javascript">    <!--        function jScriptQueryString()         {            var Hidden = document.getElementById("HiddenFieldSessionID");            var sessionId = Hidden.value;            window.location = 'JScriptQuery.aspx?CustomQueryString=jScriptQueryString___' + sessionId;         }    //--></script>
    </head>
    <body>
        <form id="form1" runat="server">
        <div>
             <a name="QuerystringHyperlink" href="ASPQuery.aspx?CustomQueryString=ASPQueryString___<%= Session.SessionID %>">Dynamic querystring generated by ASP.net</a>         <br/>         <br/>         <a href="javascript:jScriptQueryString()">Dynamic querystring generated by javascript </a>
        </div>
        <asp:HiddenField ID="HiddenFieldSessionID" runat="server" />
        </form>
    </body>
    </html>
    ```

5.  Ouvrez le fichier *Querystring.aspx.cs*, puis ajoutez le code en surbrillance suivant à la méthode Page_Load :

    ```csharp
    public partial class Querystring : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {
            Session.Add("Key", "Value");HiddenFieldSessionID.Value = Session.SessionID;
        }
    }
    ```

6.  Ajoutez un deuxième formulaire web nommé *ASPQuery.aspx*.

7.  En mode Design, faites glisser un **Label** sur la page et remplacez la valeur de sa propriété **(ID)** par **IndexLabel**.

     ![Ajouter une étiquette au formulaire web](../test/media/web_test_dynamicparameter_label.png)

8.  Faites glisser un **HyperLink** sur la page et remplacez la valeur de sa propriété **Text** par **Back**.

     ![Ajouter un lien hypertexte au formulaire web](../test/media/web_test_dynamicparameter_hyperlink.png)

9. Choisissez **(…)** pour la propriété **NavigationURL**.

     ![Modifier la propriété NavigateURL](../test/media/web_test_dynamicparameter_hyperlink_navurl.png)

     Sélectionnez *Querystring.aspx*.

     ![Choisir l'URL Querystring.aspx](../test/media/web_test_dynamicparameter_hyperlink_navurl2.png)

10. Ouvrez le fichier *ASPQuery.aspx.cs*, puis ajoutez le code en surbrillance suivant à la méthode Page_Load :

    ```csharp
    protected void Page_Load(object sender, EventArgs e)
            {
                int index;            string qstring;            string dateportion;            string sessionidportion;            qstring = Request.QueryString["CustomQueryString"];            index = qstring.IndexOf("___");            dateportion = qstring.Substring(0, index);            index += 3;            sessionidportion = qstring.Substring(index, qstring.Length - index);            if (sessionidportion != Session.SessionID)            {                Response.StatusCode = 401;                IndexLabel.Text = "Failure!  Invalid querystring parameter found.";            }            else            {                IndexLabel.Text = "Success.  Dynamic querystring parameter was found.";            }            IndexLabel.Text += "<br>\r\n";
            }
    ```

11. Ajoutez un troisième formulaire web nommé *JScriptQuery.aspx*.

     Comme pour la deuxième page, faites glisser un **Label** sur le formulaire, en affectant à sa propriété **(ID)** la valeur **IndexLabel**, puis faites glisser un **HyperLink** sur le formulaire, en affectant à sa propriété **Text** la valeur **Back** et à sa propriété **NavigationURL** la valeur **Querystring.aspx**.

     ![Ajouter et configurer le troisième formulaire web](../test/media/web_test_dynamicparameter_addwebform3.png)

12. Ouvrez le fichier *JScriptQuery.aspx.cs*, puis ajoutez le code en surbrillance suivant à la méthode Page_Load :

    ```csharp
    protected void Page_Load(object sender, EventArgs e)
            {
                int index;            string qstring;            string dateportion;            string sessionidportion;            qstring = Request.QueryString["CustomQueryString"];            index = qstring.IndexOf("___");            dateportion = qstring.Substring(0, index);            index += 3;            sessionidportion = qstring.Substring(index, qstring.Length - index);            if (sessionidportion != Session.SessionID)            {                Response.StatusCode = 401;                IndexLabel.Text = "Failure!  Invalid querystring parameter found.";            }            else            {                IndexLabel.Text = "Success.  Dynamic querystring parameter was found.";            }            IndexLabel.Text += "<br>\r\n";
            }
    ```

13. Enregistrez le projet.

14. Dans **l’Explorateur de solutions**, définissez *Querystring.aspx* comme page de démarrage.

     ![Définir la page de démarrage sur Querystring.aspx](../test/media/web_test_dynamicparameter_setstartpage.png)

15. Appuyez sur **Ctrl**+**F5** pour exécuter l’application web dans le navigateur. Copiez l'URL. Vous en aurez besoin lorsque vous enregistrerez votre test.

16. Testez les deux liens. Ils doivent chacun afficher le message de réussite. Dynamic querystring parameter found. »

     ![Exécuter l'application web](../test/media/web_test_dynamicparameter_runapp.png)

     ![Opération réussie&#33;](../test/media/web_test_dynamicparameter_runapp2.png)

## <a name="create-a-web-performance-test"></a>Créer un test de performances de site Web

1.  Ajoutez un projet de test de performances Web et de charge à votre solution.

     ![Ajouter un projet de test de charge et de performances de site web](../test/media/web_test_dynamicparameter_addtestproject.png)

2.  Renommez WebTest1.webtest en DynamicParameterSampleApp.webtest.

     ![Renommer le test de performances de site web](../test/media/web_test_dynamicparameter_renametest.png)

3.  Enregistrez le test.

     ![Enregistrer le test des performances de site web](../test/media/web_test_dynamicparameter_recordtest.png)

4.  Copiez et collez l’URL du site web que vous testez dans le navigateur.

     ![Coller l’URL du site web testé](../test/media/web_test_dynamicparameter_recordtest2.png)

5.  Parcourez l'application Web. Cliquez sur le lien ASP.NET, le lien Précédent puis le lien Javascript, suivi du lien Précédent.

     L'enregistreur de test Web affiche les URL de requête et de réponse HTTP lorsque vous naviguez dans l'applications web.

6.  Choisissez le bouton **Arrêter** sur l’enregistreur de test.

     La boîte de dialogue de détection des paramètres dynamiques affiche une barre de progression qui indique l'état de la détection de paramètres dans les réponses HTTP reçues.

7.  Le paramètre dynamique pour CustomQueryString dans la page ASPQuery est détecté automatiquement. Toutefois, le paramètre dynamique pour CustomQueryString dans la page JScriptQuery n'est pas détecté.

     Choisissez **OK** pour ajouter une règle d’extraction à *Querystring.aspx*, le liant à la page ASPQuery.

     ![Promouvoir le paramètre dynamique détecté](../test/media/web_test_dynamicparameter_promotedialog.png)

     La règle d’extraction est ajoutée à la première demande de *Querystring.aspx*.

     ![Règle d'extraction ajoutée à la requête](../test/media/web_test_dynamicparameter_autoextractionrule.png)

     Développez la deuxième demande dans l’arborescence des requêtes de *ASPQuery.aspx* : comme vous le voyez, la valeur de CustomQueryString a été liée à la règle d’extraction.

     ![CustomQueryString liée à la règle d'extraction](../test/media/web_test_dynamicparameter_autoextractionrule2.png)

8.  Enregistrez le test.

## <a name="run-the-test-to-isolate-the-non-detected-dynamic-parameter"></a>Exécuter le test pour isoler le paramètre dynamique non-détecté

1.  Exécutez le test.

     ![Exécuter le test de performances de site web](../test/media/web_test_dynamicparameter_runtest.png)

2.  La quatrième demande de la page *JScriptQuery.aspx* échoue. Accédez au test Web.

     ![Erreur de paramètre dynamique dans les résultats du test](../test/media/web_test_dynamicparameter_runresults.png)

     Le nœud de demande *JScriptQuery.aspx* est mis en surbrillance dans l’éditeur. Développez le nœud et notez que la partie « 1v0yhyiyr0raa2w4j4pwf5zl » de CustomQueryString semble être dynamique.

     ![Paramètre dynamique potentiel dans CustomQueryString](../test/media/web_test_dynamicparameter_runresults2.png)

3.  Revenez à l’Afficheur de résultats de test de performances web et sélectionnez la page *JScriptQuery.aspx* qui a échoué. Ensuite, choisissez l'onglet de requête, vérifiez que la case à cocher Afficher les données brutes est désactivée, faites défiler et choisissez la Recherche rapide sur CustomQueryString.

     ![Utiliser la recherche rapide pour isoler le paramètre dynamique](../test/media/web_test_dynamicparameter_runresultsquckfind.png)

4.  En regardant l’éditeur de test, on constate qu’une valeur `jScriptQueryString___1v0yhyiyr0raa2w4j4pwf5zl` a été affectée à CustomQueryString pour la demande *JScriptQuery.aspx* et que la partie dynamique suspecte est « 1v0yhyiyr0raa2w4j4pwf5zl ». Dans la liste déroulante Rechercher, supprimez la partie suspecte de la chaîne de recherche. La chaîne doit être « CustomQueryString=jScriptQueryString___ ».

     Leurs valeurs des paramètres dynamiques sont assignées dans l'une des requêtes qui précède la requête comportant l'erreur. Cochez la case Rechercher vers le haut et cliquer sur Suivant jusqu’à la demande précédente de *Querystring.aspx*, mise en surbrillance dans le volet des demandes. Vous devez y parvenir après avoir cliqué trois fois sur Suivant.

     ![Utiliser la recherche rapide pour isoler le paramètre dynamique](../test/media/web_test_dynamicparameter_runresultsquckfind4.png)

     Comme indiqué dans l'onglet de réponse et dans le JavaScript implémenté précédemment (voir plus bas), la valeur « jScriptQueryString___ » est assignée au paramètre de chaîne de requête CustomQueryString, qui est également concaténé avec la valeur retournée pour var sessionId.

    ```javascript
    function jScriptQueryString()          {             var Hidden = document.getElementById("HiddenFieldSessionID");             var sessionId = Hidden.value;             window.location = 'JScriptQuery.aspx?CustomQueryString=jScriptQueryString___' + sessionId;          }

    ```

     Nous savons désormais où a lieu l'erreur. Nous savons également que nous devons extraire la valeur pour sessionId. Toutefois, la valeur d'extraction est uniquement du texte. Vous devez donc isoler davantage l'erreur en essayant de localiser une chaîne où la valeur réelle de sessionId s'affiche. Si vous observez le code, vous pouvez voir que var sessionId est égal à la valeur retournée par HiddenFieldSessionID.

5.  Utilisez la recherche rapide sur HiddenFieldSessionID, en désactivant la case à cocher Rechercher vers le haut et en sélectionnant la requête actuelle.

     ![Utiliser la recherche rapide pour HiddenFieldSession](../test/media/web_test_dynamicparameter_runresultsquckfindhiddensession.png)

     Notez que la valeur retournée n'est pas la même chaîne que dans l'enregistrement du test de performances de site Web d'origine. Pour cette série de tests, la valeur retournée est « 5w4v3yrse4wa4axrafykqksq » et dans l'enregistrement d'origine, la valeur est « 1v0yhyiyr0raa2w4j4pwf5zl ». Étant donné que la valeur ne correspond pas à celle de l'enregistrement d'origine, l'erreur est générée.

6.  Étant donné que nous devons corriger le paramètre dynamique dans l'enregistrement d'origine, choisissez le résultat enregistré dans la barre d'outils.

     ![Choisir le résultat enregistré](../test/media/web_test_dynamicparameter_recordedresult.png)

7.  Dans les résultats enregistrés, sélectionnez la troisième demande ; elle est identique à la demande *Querystringrequest.aspx* que vous avez isolée dans les résultats de la série de tests.

     ![Choisir la même requête dans les résultats enregistrés](../test/media/web_test_dynamicparameter_recordedresultsselectnode.png)

     Sélectionnez l'onglet de réponse, faites défiler et choisissez la valeur du paramètre dynamique d'origine « 1v0yhyiyr0raa2w4j4pwf5zl » que vous avez isolé précédemment et ajoutez une règle d'extraction.

     ![Ajouter une règle d'extraction pour le paramètre dynamique](../test/media/web_test_dynamicparameter_recordedresultaddextractionrule.png)

     La nouvelle règle d’extraction est ajoutée à la demande *Querystring.aspx* et une valeur « Param0 » lui est affectée.

     Si la boîte de dialogue indique que des correspondances ont été trouvées pour le texte extrait auquel lier le paramètre, choisissez **Oui**.

     ![Règle d'extraction créée](../test/media/web_test_dynamicparameter_addextractiondialog.png)

8.  Choisissez **Suivant**. La première correspondance est celle que nous devons modifier, qui correspond au paramètre pour CustomQueryString dans la page JScriptQuery.

     ![Rechercher et remplacer le texte pour le paramètre](../test/media/web_test_dynamicparameter_addextractionfindreplace.png)

9. Choisissez **Remplacer**.

     ![Remplacer le texte par le paramètre](../test/media/web_test_dynamicparameter_addextractionfindreplace2.png)

     Le paramètre QueryString sous la demande *JScriptQuery.aspx* est mis à jour à l’aide du nouveau paramètre de contexte : CustomQueryString=jScriptQueryString___ {{Param0}}.

     ![Paramètre appliqué à la chaîne de requête](../test/media/web_test_dynamicparameter_addextractionfindreplace3.png)

10. Fermez la boîte de dialogue **Rechercher et remplacer**. Notez que, dans l’arborescence des requêtes, la structure du paramètre dynamique détecté est semblable à celle du paramètre dynamique non-détecté que vous avez mis en corrélation.

     ![Paramètres dynamiques détectés et corrélés](../test/media/web_test_dynamicparameter_conclusion.png)

11. Exécutez le test. Il fonctionne maintenant sans échec.

## <a name="qa"></a>Questions et réponses

### <a name="q-can-i-re-run-dynamic-parameter-detection-if-my-web-app-gets-modified"></a>Q : Puis-je réexécuter la détection de paramètres dynamiques si mon application Web est modifiée ?

 **R :** Oui, utilisez la procédure suivante :

1.  Dans la barre d’outils, choisissez le bouton **Promouvoir les paramètres dynamiques en paramètres de test web**.

     Une fois le processus de détection terminé, si des paramètres dynamiques sont détectés, la boîte de dialogue **Promouvoir les paramètres dynamiques en paramètres de test web** s’affiche.

     Les paramètres dynamiques sont listés sous la colonne Paramètres dynamiques. Les requêtes dont les paramètres dynamiques doivent être extraits et auxquelles ils doivent être liés sont listées sous les colonnes Extraire le paramètre de la réponse et Lier à la requête.

     Si vous choisissez un paramètre dynamique dans la boîte de dialogue **Promouvoir les paramètres dynamiques en paramètres de test web**, deux demandes sont mises en surbrillance dans l’arborescence des requêtes de l’éditeur de test de performances web. La première requête est celle à laquelle la règle d'extraction doit être ajoutée. La seconde requête est celle à laquelle la valeur extraite doit être liée.

2.  Activez ou désactivez la case à cocher en regard des paramètres dynamiques que vous voulez mettre en corrélation automatiquement. Par défaut, tous les paramètres dynamiques sont activés.

### <a name="q-do-i-need-to-configure-visual-studio-to-detect-dynamic-parameters"></a>Q : Dois-je configurer Visual Studio pour détecter les paramètres dynamiques ?

 **R :** La configuration Visual Studio par défaut consiste à détecter les paramètres dynamiques quand vous enregistrez un test de performances web. Toutefois, si les options Visual Studio sont configurées pour ne pas détecter de paramètres dynamiques, ou si l’application web qui est testée est modifiée à l’aide de paramètres dynamiques supplémentaires, vous pouvez toujours exécuter une détection des paramètres dynamiques dans l’éditeur de test de performances Web.